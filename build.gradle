plugins {
    id 'org.jetbrains.kotlin.jvm' version '1.3.72'
}

apply plugin: 'application'

defaultTasks 'runJar'

group 'dev.binclub'
version '1.0'

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
}

project.ext.lwjglVersion = "3.2.3"
project.ext.steamworks4jVersion = "1.8.0"
project.ext.lwjglNatives = "natives-windows"

configurations {
    runtimeNative {
        canBeResolved = true
        extendsFrom runtimeOnly
    }
}

dependencies {
    compile "org.jetbrains.kotlin:kotlin-stdlib-jdk8"


    compile platform("org.lwjgl:lwjgl-bom:$lwjglVersion")

    compile "org.lwjgl:lwjgl"
    compile "org.lwjgl:lwjgl-stb"
    compile "org.lwjgl:lwjgl-glfw"
    compile "org.lwjgl:lwjgl-opengl"

    runtimeNative "org.lwjgl:lwjgl::$lwjglNatives"
    runtimeNative "org.lwjgl:lwjgl-stb::$lwjglNatives"
    runtimeNative "org.lwjgl:lwjgl-glfw::$lwjglNatives"
    runtimeNative "org.lwjgl:lwjgl-opengl::$lwjglNatives"

    implementation "com.code-disaster.steamworks4j:steamworks4j:${steamworks4jVersion}"

    compile 'com.github.kotlin-graphics:glm:jdk8-SNAPSHOT'

    compile "com.github.kotlin-graphics.imgui:imgui-core:jdk8-SNAPSHOT"
    compile "com.github.kotlin-graphics.imgui:imgui-gl:jdk8-SNAPSHOT"
    compile "com.github.kotlin-graphics.imgui:imgui-glfw:jdk8-SNAPSHOT"

    compile "com.github.kotlin-graphics.uno-sdk:uno-core:jdk8-SNAPSHOT"

    compile "com.github.cookiedragon234:EventDispatcher:-SNAPSHOT"
    compile "com.github.cookiedragon234:gln:jdk8-SNAPSHOT"
}


def mainClass = 'dev.binclub.fps.MainKt'
def clientClass = 'dev.binclub.fps.client.Client'
def serverClass = 'dev.binclub.fps.server.Server'
mainClassName = mainClass


jar {
    manifest { attributes 'Main-Class': mainClassName }
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    from { configurations.runtimeNative.collect { it.isDirectory() ? it : zipTree(it) } }
}

task runJar(type: JavaExec) {
    main = "-jar";
    args jar.archivePath
}
runJar.dependsOn(build)


compileKotlin {
    kotlinOptions.jvmTarget = "1.8"
}
compileTestKotlin {
    kotlinOptions.jvmTarget = "1.8"
}

tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).all {
    kotlinOptions.freeCompilerArgs += ["-Xopt-in=kotlin.RequiresOptIn"]
}
